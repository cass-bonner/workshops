<!DOCTYPE html>
<html lang="en">
<meta>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="serverless.css" />
<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
<script src="https://www.w3schools.com/lib/w3.js"></script>
</meta>
<body background="images/background.png">
</script>
<table>
  <tr>
    <td align="left" width="25%"><img src="images/aws_icon.png"/></td>
    <td align = "center" width = "60%">
<listing class="pretext">
  <table>
<tr>
<td width="100%"><a href="serverless_prerequisites.html">Serverless Workshop Prerequisites</a></td>
</tr>
<tr>
<td width="100%"><a href="serverless.html">Serverless Overview</a><br/></td>
</tr>
<tr>
<td width="100%"><a href="serverless-static-website.html">Serverless Static Webabb</a><br/></td>
</tr>
<tr>
<td width="100%"><a href="serverless-dynamic-website.html">Serverless Dynamic Webapp</a><br/></td>
</tr>
<tr>
<td width="100%"><a href="serverless-chatbot.html">Serverless Lex Chatbot</a><br/></td>
</tr></table>
</listing>
    </td>
    <td align="right" width="25%"><img src="images/iag_icon.png"/></td>
 </tr>
</table>
<br/>
<br/>
<p ="font-family:verdana">
<h1 align="center">IAG AWS Serverless Workshop - Prerequisites</h1>
<listing class="pretext">
<img src="images/bullet.png"> <a href="#leaders">Pre-reqs for Dev Guild Leads</a>
<img src="images/bullet.png"> <a href="#students">Pre-reqs for Participants</a>
</listing>
<div w3-include-html="toc.html"></div>
<h4 id="leaders"> Preparation for DevGuild Team Leads/Cloud Team</h4>
<listing class="pretext">
<ol> <li>Create an iam user for every particpant, and give them a password as well as a set of AWS Access Keys and give these to the participants. Assign them a role with the appropriate permissions - please see email discussion for this. 
<li>Create the following roles:
<ul>
<li>  IAM Users should be assigned to a group, and ideally the group (and and any user if applicable) policies should apply least privileges policy (only grant access as required). In a hackathon account, one way to do this would be to constrain access to required services for policies where the user can only write(in addition to read actions) for resources named with ther username. For example the below policy could be added for DynamoDB (along with the provided AWS  AmazonDynamoDBReadOnlyAccess policy - or even easier just attach the 'ReadOnlyAccess' managed policy to the group) 

This is recommended practice and would need permutated for every service because the "resource vendor" such as s3 versus dynamodb has to be fully qualified.  

<ul>
<li>
Create a Custom Policy which provides admin permissions, but only for resources with the user's name in it.

This can be performed via command line interface, SDKs or via console. Here's the console instructions.

<li>In the console, navigate to IAM -> Groups -> Create New Group. Use adminForUsername as the group name. Click 'Next Step'
<li>In the 'Attach Policy' screen, enter 'ReadOnlyAccess' and AWSCodeCommitFullAccess then tick the the button.
<li>Select 'Next Step' and then 'Create Group'.
<li>Select on the adminForUser group , and expand the 'Inline Policies' section at the bottom of the page. 	
<li>Select 'click here' to set permissions. Select the 'Custom Policy' 	in Set Permissions and then select 'Select'
<li>Enter 'adminForUsername' in the name and paste the below for the policy.

    <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#username-policies">Copy</button>
<pre>
<span id="username-policies">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "usernamesAll",
            "Effect": "Allow",
            "Action": [
                "*"
            ],
            "Resource": [
                "arn:aws:s3:::*${aws:username}*/*",
                "arn:aws:dynamodb:us-east-1::table/*${aws:username}*",
                "arn:aws:iam::XXXXX:user/*${aws:username}*",
                "arn:aws:iam::XXXXX:role/*${aws:username}*",
                "arn:aws:iam::XXXXX:policy/*${aws:username}*",
                "arn:aws:iam::XXXXX:instance-profile/*${aws:username}*",
                "arn:aws:sts::XXXXX:federated-user/*${aws:username}*",
                "arn:aws:sts::XXXXX:assumed-role/*${aws:username}*/*${aws:username}*",
                "arn:aws:iam::XXXXX:mfa/*${aws:username}*",
                "arn:aws:iam::XXXXX:server-certificate/*${aws:username}*",
                "arn:aws:iam::XXXXX:saml-provider/*${aws:username}*",
                "arn:aws:iam::XXXXX:oidc-provider/*${aws:username}*",
                "arn:aws:rds:*::db:*${aws:username}*",
                "arn:aws:elasticbeanstalk:*::environment/*${aws:username}*/*",
                "arn:aws:artifact:::report-package/document-type/report-type",
                "arn:aws:lex:*::bot:*${aws:username}*:*",
                "arn:aws:lex:*::intent:*${aws:username}*:*",
                "arn:aws:lex:*::slottype:*${aws:username}*:*",
                "arn:aws:lambda:us-east-1:XXXXX:function:*${aws:username}*/*",
                "arn:aws:lambda:ap-southeast-2:XXXXX:function:*${aws:username}*/*",
                "arn:aws:lambda:us-east-1:XXXXX:event-source-mappings:*",
                "arn:aws:iam::XXXXX:role/lambda_basic_execution",
                "arn:aws:iam::XXXXX:role/lambda_basic_execution/*${aws:username}*",
                "arn:aws:cognito-identity:*:XXXXX:identitypool/*${aws:username}*",
                "arn:aws:cognito-idp:us-east-1:XXXXX:userpool/*",
                "arn:aws:autoscaling:us-east-1:XXXXX:scalingPolicy:*:autoScalingGroupName/*${aws:username}*:policyName/*${aws:username}*",
                "arn:aws:acm:us-east-1:XXXXX:certificate/*",
                "arn:aws:cloudformation:us-east-1:XXXXX:stack/*${aws:username}*/*",
                "arn:aws:cloudsearch:us-east-1:XXXXX:domain/*${aws:username}*",
                "arn:aws:cloudtrail:us-east-1:XXXXX:trail/*${aws:username}*",
                "arn:aws:events:us-east-1:XXXXX:rule/*${aws:username}*",
                "arn:aws:logs:us-east-1:*:*",
                "arn:aws:codebuild:us-east-1:XXXXX:project/*${aws:username}*",
                "arn:aws:codebuild:us-east-1:XXXXX:build/*${aws:username}*:*",
                "arn:aws:codecommit:us-east-1:XXXXX:*${aws:username}*",
                "arn:aws:codedeploy:us-east-1:XXXXX:application:*${aws:username}*",
                "arn:aws:codedeploy:us-east-1:XXXXX:instance/*${aws:username}*",
                "arn:aws:cognito-sync:us-east-1:XXXXX:identitypool/*",
                "arn:aws:cognito-sync:us-east-1:XXXXX:identitypool/*/identity/*",
                "arn:aws:config:us-east-1:XXXXX:config-rule/*${aws:username}*",
                "arn:aws:codepipeline:us-east-1:XXXXX:*${aws:username}*",
                "arn:aws:codestar:us-east-1:XXXXX:*${aws:username}*",
                "arn:aws:ecr:us-east-1:XXXXX:repository/*${aws:username}*",
                "arn:aws:ecs:us-east-1:XXXXX:cluster/*${aws:username}*",
                "arn:aws:ecs:us-east-1:XXXXX:container-instance/*",
                "arn:aws:ecs:us-east-1:XXXXX:task-definition/*${aws:username}*:*",
                "arn:aws:ecs:us-east-1:XXXXX:service/*${aws:username}*",
                "arn:aws:ecs:us-east-1:XXXXX:task/*",
                "arn:aws:ecs:us-east-1:XXXXX:container/*",
                "arn:aws:ec2:us-east-1:XXXXX:customer-gateway/*",
                "arn:aws:ec2:us-east-1:XXXXX:dedicated-host/*",
                "arn:aws:ec2:us-east-1:XXXXX:dhcp-options/*",
                "arn:aws:ec2:us-east-1::image/*",
                "arn:aws:ec2:us-east-1:XXXXX:instance/*",
                "arn:aws:iam::XXXXX:instance-profile/*${aws:username}*",
                "arn:aws:ec2:us-east-1:XXXXX:internet-gateway/*${aws:username}*",
                "arn:aws:ec2:us-east-1:XXXXX:key-pair/*${aws:username}*",
                "arn:aws:ec2:us-east-1:XXXXX:network-acl/*",
                "arn:aws:ec2:us-east-1:XXXXX:network-interface/*",
                "arn:aws:ec2:us-east-1:XXXXX:placement-group/*${aws:username}*",
                "arn:aws:ec2:us-east-1:XXXXX:route-table/*",
                "arn:aws:ec2:us-east-1:XXXXX:security-group/*",
                "arn:aws:ec2:us-east-1:XXXXX:snapshot/*",
                "arn:aws:ec2:us-east-1:XXXXX:subnet/*",
                "arn:aws:ec2:us-east-1:XXXXX:volume/*",
                "arn:aws:ec2:us-east-1:XXXXX:vpc/*",
                "arn:aws:ec2:us-east-1:XXXXX:vpc-peering-connection/*",
                "arn:aws:ec2:us-east-1:XXXXX:vpn-connection/*",
                "arn:aws:ec2:us-east-1:XXXXX:vpn-gateway/*",
                "arn:aws:elasticbeanstalk:us-east-1:XXXXX:application/*${aws:username}*",
                "arn:aws:elasticbeanstalk:us-east-1:XXXXX:applicationversion/*${aws:username}*/*",
                "arn:aws:elasticbeanstalk:us-east-1::solutionstack/*",
                "arn:aws:elasticbeanstalk:us-east-1:XXXXX:configurationtemplate/*${aws:username}*/*",
                "arn:aws:elasticfilesystem:us-east-1:XXXXX:file-system-id/*",
                "arn:aws:elasticloadbalancing:us-east-1:XXXXX:loadbalancer/app/*${aws:username}*/*",
                "arn:aws:elasticloadbalancing:us-east-1:XXXXX:listener/app/*${aws:username}*/*/*",
                "arn:aws:elasticloadbalancing:us-east-1:XXXXX:listener-rule/app/*${aws:username}*/*/*/*",
                "arn:aws:elasticloadbalancing:us-east-1:XXXXX:targetgroup/*${aws:username}*/*",
                "arn:aws:elastictranscoder:us-east-1:XXXXX:preset/*",
                "arn:aws:elasticache:us-east-1:XXXXX:cluster:*${aws:username}*",
                "arn:aws:elasticache:us-east-1:XXXXX:snapshot:*${aws:username}*",
                "arn:aws:es:us-east-1:XXXXX:domain/*${aws:username}*",
                "arn:aws:glacier:us-east-1:XXXXX:vaults/*${aws:username}*",
                "arn:aws:health:us-east-1::event/*",
                "arn:aws:health:us-east-1:XXXXX:entity/*",
                "arn:aws:iot:us-east-1:XXXXX:cert/*",
                "arn:aws:iot:us-east-1:XXXXX:policy/*${aws:username}*",
                "arn:aws:iot:us-east-1:XXXXX:rule/*${aws:username}*",
                "arn:aws:iot:us-east-1:XXXXX:client/*",
                "arn:aws:kms:us-east-1:XXXXX:key/*",
                "arn:aws:kms:us-east-1:XXXXX:alias/*${aws:username}*",
                "arn:aws:firehose:us-east-1:XXXXX:deliverystream/*${aws:username}*",
                "arn:aws:kinesis:us-east-1:XXXXX:stream/*${aws:username}*",
                "arn:aws:machinelearning:us-east-1:XXXXX:datasource/*${aws:username}*",
                "arn:aws:machinelearning:us-east-1:XXXXX:mlmodel/*${aws:username}*",
                "arn:aws:machinelearning:us-east-1:XXXXX:batchprediction/*${aws:username}*",
                "arn:aws:machinelearning:us-east-1:XXXXX:evaluation/*${aws:username}*",
                "arn:aws:mobilehub:us-east-1:XXXXX:project/*",
                "arn:aws:polly:us-east-1:XXXXX:lexicon/*${aws:username}*",
                "arn:aws:redshift:us-east-1:XXXXX:cluster:*${aws:username}*",
                "arn:aws:redshift:us-east-1:XXXXX:my-cluster/*${aws:username}*",
                "arn:aws:redshift:us-east-1:XXXXX:parametergroup:*${aws:username}*",
                "arn:aws:redshift:us-east-1:XXXXX:securitygroup:*",
                "arn:aws:redshift:us-east-1:XXXXX:snapshot:*${aws:username}*/*",
                "arn:aws:redshift:us-east-1:XXXXX:subnetgroup:*",
                "arn:aws:redshift:us-east-1:XXXXX:dbuser:*${aws:username}*/*",
                "arn:aws:rds:us-east-1:XXXXX:db:*${aws:username}*",
                "arn:aws:rds:us-east-1:XXXXX:snapshot:*${aws:username}*",
                "arn:aws:rds:us-east-1:XXXXX:cluster:*${aws:username}*",
                "arn:aws:rds:us-east-1:XXXXX:cluster-snapshot:*${aws:username}*",
                "arn:aws:rds:us-east-1:XXXXX:og:*${aws:username}*",
                "arn:aws:rds:us-east-1:XXXXX:pg:*${aws:username}*",
                "arn:aws:rds:us-east-1:XXXXX:cluster-pg:*${aws:username}*3",
                "arn:aws:rds:us-east-1:XXXXX:secgrp:*${aws:username}*",
                "arn:aws:rds:us-east-1:XXXXX:subgrp:*${aws:username}*",
                "arn:aws:rds:us-east-1:XXXXX:es:*",
                "arn:aws:route53:::hostedzone/*",
                "arn:aws:route53:::change/*",
                "arn:aws:route53:::change/*",
                "arn:aws:ssm:us-east-1:XXXXX:document/*",
                "arn:aws:ssm:us-east-1:XXXXX:parameter/*${aws:username}*",
                "arn:aws:ssm:us-east-1:XXXXX:patchbaseline/*",
                "arn:aws:ssm:us-east-1:XXXXX:maintenancewindow/*",
                "arn:aws:ssm:us-east-1:XXXXX:automation-execution/*",
                "arn:aws:ssm:us-east-1:XXXXX:automation-activity/*${aws:username}*",
                "arn:aws:ssm:us-east-1:XXXXX:automation-definition/*${aws:username}*:*",
                "arn:aws:ssm:us-east-1:XXXXX:managed-instance/*${aws:username}*",
                "arn:aws:ssm:us-east-1:XXXXX:managed-instance-inventory/*${aws:username}*",
                "arn:aws:sns:*:XXXXX:*${aws:username}*",
                "arn:aws:sns:us-east-1:XXXXX:*${aws:username}*:*",
                "arn:aws:sqs:us-east-1:XXXXX:*${aws:username}*",
                "arn:aws:swf:us-east-1:XXXXX:/domain/*${aws:username}*",
                "arn:aws:swf:*:XXXXX:/domain/*",
                "arn:aws:states:us-east-1:XXXXX:activity:*${aws:username}*",
                "arn:aws:states:us-east-1:XXXXX:stateMachine:*${aws:username}*",
                "arn:aws:states:us-east-1:XXXXX:execution:*${aws:username}*:*",
                "arn:aws:waf::XXXXX:*/*",
                "arn:aws:waf-regional::XXXXX:*/*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "cloudwatch:GetMetricStatistics",
                "cloudwatch:DescribeAlarms",
                "cloudwatch:DescribeAlarmsForMetric",
                "kms:DescribeKey",
                "kms:ListAliases",
                "lambda:GetPolicy",
                "lambda:ListFunctions",
                "lex:*",
                "polly:DescribeVoices",
                "polly:SynthesizeSpeech"
            ],
            "Resource": [
                "*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "lambda:AddPermission",
                "lambda:RemovePermission"
            ],
            "Resource": "*",
            "Condition": {
                "StringLike": {
                    "lambda:Principal": "lex.amazonaws.com"
                }
            }
        },
        {
            "Effect": "Allow",
            "Action": [
                "iam:GetRole",
                "iam:DeleteRole"
            ],
            "Resource": [
                "arn:aws:iam::*:role/aws-service-role/lex.amazonaws.com/AWSServiceRoleForLexBots",
                "arn:aws:iam::*:role/aws-service-role/channels.lex.amazonaws.com/AWSServiceRoleForLexChannels"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "iam:PassRole",
                "iam:ListInstanceProfiles"
            ],
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "iam:CreateServiceLinkedRole"
            ],
            "Resource": [
                "arn:aws:iam::*:role/aws-service-role/lex.amazonaws.com/AWSServiceRoleForLexBots"
            ],
            "Condition": {
                "StringLike": {
                    "iam:AWSServiceName": "lex.amazonaws.com"
                }
            }
        },
        {
            "Effect": "Allow",
            "Action": [
                "iam:DetachRolePolicy"
            ],
            "Resource": [
                "arn:aws:iam::*:role/aws-service-role/lex.amazonaws.com/AWSServiceRoleForLexBots"
            ],
            "Condition": {
                "StringLike": {
                    "iam:PolicyArn": "arn:aws:iam::aws:policy/aws-service-role/AmazonLexBotPolicy"
                }
            }
        },
        {
            "Effect": "Allow",
            "Action": [
                "iam:CreateServiceLinkedRole"
            ],
            "Resource": [
                "arn:aws:iam::*:role/aws-service-role/channels.lex.amazonaws.com/AWSServiceRoleForLexChannels"
            ],
            "Condition": {
                "StringLike": {
                    "iam:AWSServiceName": "channels.lex.amazonaws.com"
                }
            }
        },
        {
            "Effect": "Allow",
            "Action": [
                "iam:DetachRolePolicy"
            ],
            "Resource": [
                "arn:aws:iam::*:role/aws-service-role/channels.lex.amazonaws.com/AWSServiceRoleForLexChannels"
            ],
            "Condition": {
                "StringLike": {
                    "iam:PolicyArn": "arn:aws:iam::aws:policy/aws-service-role/LexChannelPolicy"
                }
            }
        }
    ]
}

</span>
</pre>
<li> Save the policy- you should see three policies on the group - ReadOnlyAcess,AWSCodeCommitFullAccess, and adminForUsername 
<li> Add all required users to this group.
</ul>

<li> There are four service roles required for the Serverless Workshop that either can be created manually (via script or console) or we can supply a <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html">CloudFormation template</a>. We recommend the team or users create them as a learning experience. For context, the roles include:

a) Role to provide trust to lambda to invoke Amazon DynamoDB APIs that support querying a table which includes the user's name <br/>
b) Role to provide trust to lambda to invoke Amazon DynamoDB APIs that support writing (batch) to a table which includes the user's name <br/>
c) Role to provide trust to lambda to invoke another Lambda function which will be used within our Amazon Lex Bot<br/>
d) Role to provide trust to lambda to invoke AWS Step Functions APIs for start-execution & describe-execution which are named as a particular user.

Because the service roles are not running as a particular user, we can not use the IAM policy variable as we can for the policies created for the users, so the username will need to be static if we go with this approach. You can also grant less granular policies but it is not recommended. 

If you use the below samples please be sure to change the userid to the static name of the userid. This can be done via a script or we can ask each participant to defines the roles. Create a customer policy with the below definition and then Create a role and attach it as a custom policy.

<ul>
<li>Lamda Trust Role (+policies): [userid]-lambda-write-ddb
    <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#Lambda-policy-write">Copy</button>
<pre>
<span id="Lambda-policy-write">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "[userid]LambdaWriteDdb",
            "Effect": "Allow",
            "Action": [
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:BatchWriteItem"
            ],
            "Resource": [
                "arn:aws:dynamodb:*:XXXXX:table/*INSERT_STATIC_USERNAME_HERE*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents"
            ],
            "Resource": "*"
        }
    ]
}

</pre></span>

<li> Lambda Trust Role (+DynamoDB Read): [userid]-lambda-read-ddb
    <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#Lambda-policy-read">Copy</button>
<pre><span id="Lambda-policy-read">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "[insert-userid]LambdaReadDdb",
            "Effect": "Allow",
            "Action": [
                "dynamodb:GetItem",
                "dynamodb:BatchGetItem",
                "dynamodb:Query"
            ],
            "Resource": [
                "arn:aws:dynamodb:*:*:table/*INSERT_STATIC_USERNAME_HERE*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents"
            ],
            "Resource": "*"
        }
    ]
}
</pre></span>

<li> Lambda Trust Role (invoke Other Lambdas): [userid]-lambda-invoke-lambda
    <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#Lambda-invoke">Copy</button>
<pre><span id="Lambda-invoke">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "[STATIC_NAME]LambdaInvokeLambda",
            "Effect": "Allow",
            "Action": [
                "lambda:InvokeFunction"
            ],
            "Resource": [
                "arn:aws:lambda:*:XXXXX:function:*STATIC_NAME*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents"
            ],
            "Resource": "*"
        }
    ]
}
</pre></span>
<li>Lamda Trust Role (+policies for StepFunctions APIs): [userid]-lambda-sfn-start-desc-exec

    <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#lam-sfn">Copy</button>
<pre>
<span id="lam-sfn">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "[userId]SfnStartDescExec",
            "Effect": "Allow",
            "Action": [
                "states:StartExecution",
                "states:DescribeExecution"
            ],
            "Resource": [
                "arn:aws:states:ap-southeast-2:XXXXX:execution:*[userid]*:*",
                "arn:aws:states:ap-southeast-2:XXXXX:stateMachine:*[userid]*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents"
            ],
            "Resource": "*"
        }
    ]
}
</pre></span>
</ul>
</ul>
</ul>
</listing>
<h4 id="students"> Preparation for Students</h4>
<listing class="pretext">
<ol type="1">
<li>A laptop with access to AWS console
<li>If using windows, ideally  have Cygwin installed.
<li>The laptop must have the AWS Command Line Interface (CLI) set up on it. Instructions to <a href="http://docs.aws.amazon.com/cli/latest/userguide/installing.html">install the CLI are here</a>.
<li>The laptop must be configured for the AWS Command Line Interface (CLI) . Instructions to <a href="http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html">configure the CLI are here</a>. Each participant should use their own AWS Access Key Pairs provided by the Dev Guild.
<li>You can either make a directory called aws-workspace (or whatever you'd like to call it) - or you are welcome to work in an existing npm package if that is what you would like. Either way, you need to start working in a directory where npm has been initialized. If you want to start fresh please run the following and except all the defaults for initialization (or fill them in if you prefer):

    <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#bild">Copy</button>
<pre>
<span id="bild">
mkdir aws-workspace
cd  aws-workspace
npm init
</span></pre>
</li>
<h3>Node.js & npm</h3>
<li>Node must be installed. If you do not have it please download from the <a href="https://nodejs.org/en/download/">Node.js</a> site. 
<li>npm is included with node, but you should be on a recent version.You can update npm with 'npm install npm@latest -g'</li>
    <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#testnpm">Copy</button>
Verify node and npm installation and versions:
<pre>
<span id="testnpm">
node -v
npm -v
</span></pre>
</li>
<li> If npm is not installed, copy and paste the to get started commands or click copy here: 
    <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#npminstall">Copy</button>
<pre>
<span id="npminstall">
npm install
npm run dev
</span></pre>
<h3>vue.js</h3>
<<a href="https://en.wikipedia.org/wiki/Vue.js">From Wikipedia</a>>

Vue.js (commonly referred to as Vue; pronounced /vjuÀê/, like view) is an open-source progressive JavaScript framework for building user interfaces. Integration into projects that use other JavaScript libraries is made easy with Vue because it is designed to be incrementally adoptable. Vue can also function as a web application framework capable of powering advanced single-page applications.

According to a 2016 JavaScript survey, Vue has an 89% developer satisfaction rating. It accumulates around 95 GitHub stars per day, and is the 10th most starred project on GitHub of all time.</i>

<li>There's not enough javascript frameworks around :) so let's check it out! The process for most modern js frameworks will be similiar to this. Copy the below - you can skil the first two lines if you do have vue installed.

    <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#setupvue">Copy</button>
<pre>
<span id="setupvue">npm install vue
 npm install --global vue-cli
 vue init webpack aws-serverless-workshop 
</pre>
Hit return for project name taking the default aws-serverless-workshop as well as all the other defaults.

<li>Once the vue init is complete, run these commands:

    <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#setupvue">Copy</button>
<pre>
<span id="setupvue">cd aws-serverless-workshop 
 npm install
 npm run dev</span>
</pre>


<li>It should start the dev server, and open a page in your browser such as this:

<div class="vue-image-blurred-edge"></div>
<img src="images/vue-screenshot.png"/>

<li>You can kill the vue dev server now.
</ul>
<li>Every participant should test their command line access with this command:
    <script src="js/clipboard.js-master/dist/clipboard.min.js"></script>
    <script>
    var clipboard = new Clipboard('.btn');
    clipboard.on('success', function(e) {
        console.log(e);
    });
    clipboard.on('error', function(e) {
        console.log(e);
    });
    </script>
    <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#role">Copy</button>
<pre> <span id="role">aws iam get-role --role-name [userid]-lambda-read-ddb</span> </pre>
<li>You should see something such as:
<div class="black-background"><pre class="black-background">
labguide: bonnerca$ aws iam get-role --role-name -lambda-read-ddb 
   {
    "Role": {
        "AssumeRolePolicyDocument": {
            "Version": "2012-10-17", 
            "Statement": [
                {
                    "Action": "sts:AssumeRole", 
                    "Effect": "Allow", 
                    "Principal": {
                        "Service": "lambda.amazonaws.com"
                    }
                }
            ]
        }, 
        "RoleId": "XXXXX", 
        "CreateDate": "2017-06-16T05:51:15Z", 
        "RoleName": "userid-lambda-read-ddb", 
        "Path": "/", 
        "Arn": "arn:aws:iam::XXXXXXXX:role/userid-lambda-read-ddb"
    }
}

</pre>
<li>An IAM role is similar to a user, in that it is an AWS identity with permission policies that determine what the identity can and cannot do in AWS. However, instead of being uniquely associated with one person, a role is intended to be assumable by anyone who needs it. Also, a role does not have any credentials (password or access keys) associated with it. Instead, if a user is assigned to a role, access keys are created dynamically and provided to the user.

You can use roles to delegate access to users, applications, or services that don't normally have access to your AWS resources. For example, you might want to grant users in your AWS account access to resources they don't usually have, or grant users in one AWS account access to resources in another account. Or you might want to allow a mobile app to use AWS resources, but not want to embed AWS keys within the app (where they can be difficult to rotate and where users can potentially extract them). Sometimes you want to give AWS access to users who already have identities defined outside of AWS, such as in your corporate directory. Or, you might want to grant access to your account to third parties so that they can perform an audit on your resources.

For these scenarios, you can delegate access to AWS resources using an IAM role. This section introduces roles and the different ways you can use them, when and how to choose among approaches, and how to create, manage, switch to (or assume), and delete roles.

<li>This role was created as part of the setup to the lab. It allows AWS Lambda (you'll learn more about that in the lab) to assume a role and when it is invoked. The role has an inline policy which looks like this:

<pre><span id="Lambda-policy-read">
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "[userid]LambdaWriteDdb",
            "Effect": "Allow",
            "Action": [
                "dynamodb:GetItem",
                "dynamodb:BatchGetItem",
                "dynamodb:Query"
            ],
            "Resource": [
                "arn:aws:dynamodb:*:*:table/*userid*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents"
            ],
            "Resource": "*"
        }
    ]
}
</pre></span>

<li>This policy statement says to allow the ability to invoke three APIs to DynamoDB: getItem, BatchGetItem, and Query.  And the resource on which they are allows to invoke those APIs is for a table that contains the user's id (yours should display your id).  Therefore, it only allows the running Lambda function to query only tables with your user id.  The second statement allows the Lambda Function to write to AWS CloudWatch Logs,  which allows you to monitor, store, and access your log files from Amazon Elastic Compute Cloud (Amazon EC2) instances, AWS CloudTrail, and other sources. You can then retrieve the associated log data from CloudWatch Logs.

This is in line with the AWS IAM Best Practices as you only want to give access to the resources required. We will be defining a Lambda function that only needs to read from Amazon DynamoDB (a fully managed NoSQL database service - more on this in the Labs), as well as another Lambda function that can write to DynamoDB. The write policy for the Lambda that needs to write looks like this:
<pre>
<span id="Lambda-policy-write">
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "[userid]LambdaWriteDdb",
            "Effect": "Allow",
            "Action": [
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:BatchWriteItem"
            ],
            "Resource": [
                "arn:aws:dynamodb:*:XXXXX:table/*userid*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents"
            ],
            "Resource": "*"
        }
    ]
}
</span></pre>
<li>This role ensures that your Lambda function can only write to tables that have your name in it. Note how it grants additional API Invocations for PutItem, BatchWriteItem, etc. This role would only be provided to a Lambda that needs to write. Dynamo DB actually supports fine-grained controls which you can read about <a href="https://aws.amazon.com/blogs/aws/fine-grained-access-control-for-amazon-dynamodb/">here</a>. 
</ol>
</div>
</listing>

 
<a href="serverless.html"/>&lt;Serverless Workshop&gt;</a>

</font>
</p

</body>
</html>
