<html>
<meta>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="serverless.css" />
<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
</meta>
<body background="images/background.png">
<script src="js/clipboard.js-master/dist/clipboard.min.js"></script>

    <script>
    var clipboard = new Clipboard('.btn');
    clipboard.on('success', function(e) {
        console.log(e);
    });
    clipboard.on('error', function(e) {
        console.log(e);
    });
    </script>

<table>
  <tr>
    <td align="left" width="700"><img src="images/aws_icon.png"/></td>
    <td align="right" width="500"><img src="images/iag_icon.png"/></td>
 </tr>
</table>
<br/>
<br/>
<p ="font-family:verdana">
<h1 align="center">Serverless static website on AWS</h1>
<table cellpadding="20px"  align="center">
<tr>
<td width="50%"><img src="images/s3.png"/><br/><a href="http://docs.aws.amazon.com/AmazonS3/latest/gsg/GetStartedWithS3.html">Amazon S3</a></td>
<td width="50%"><img src="images/vue.png"/><br/><a href="https://vuejs.org/">Vue.js</a></td>
</tr>
</table>
Serverless is a great fit for building a webite. After all what do you need:

<br/>
<br/>
<br/>
    <img src="images/serverless-arch.png " />
<br/>
<br/>
<br/>
We minimally need:

<ul>
<li> A User Interface (UI). Of course the solution will be different whether you want to build a traditional website intended for a browser, a native app for mobile phones, etc. For this workshop we'll just build basic html/javascript for a traditional website but the design would not vary significantly.  We will use <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/Welcome.html">S3 (Simple Storage Service)</a> to serve our static file requests. In practice you'd likely want to include a <a href="http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/Introduction.html">Content Delivery Network (CDN)</a> such as AWS Cloud Front to serve the static files from Edge locations to provide better performance for the users. We could create a simple html file but that's boring :) and we want to build on this with dynamic ajax REST APIs in the next lesson so we are going to leverage Vue.js Framework. Vue is a progressive and lightweight javascript framework that takes the best features of some other frameworks and makes it easy to build websites. Further, later in this workshop we will layer on a Amazon Lex ChatBox and we will utilize an AWS Github awslabs project that also uses Vue so it will be good to get familiar with it if you're not already.
<li> Dynamic Components. The static files come from S3, but few websites only need static content. We might need to post data to our backend, or query data specific to a given user, or their particular request. We will use <a href="http://docs.aws.amazon.com/apigateway/latest/developerguide/welcome.html">Amazon API Gateway</a> to define the various dynamic use cases (APIs) for which we need to serve our pages in the next section of this workshop. We will use <a href="http://docs.aws.amazon.com/lambda/latest/dg/welcome.html">AWS Lambda</a> to run the dynamic logic/code to fulfill our requests, which does not require you to provision or manage servers, and manages resiliency and scale on your behalf.  We use <a href="http://docs.aws.amazon.com/step-functions/latest/dg/welcome.html">AWS Step Functions</a> to coordinate the components of distributed applications and microservices using visual workflows. 
<br/>
<br/>
  Enough reading, let's get started!
<br/>
<br/>
<br/>

Let's start by setting up a project in your local IDE (or you're welcome to work directly with an editor).
<br/><ol type="1"><li>Navigate to the aws-serverless-workshop directory that you created in the <a href="serverless-prerequisites.html"> Prerequisites</a> - OR - setup a project pointing to this directory in your IDE.
<br/>
<li>Let's start up the Vue dev mode server so that we can see our application. From directly within the aws-serverless-workshop, type:
  <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#startdev">Copy</button>
<pre><span id="startdev">

npm run dev

</span></pre>
<br/>

This should start the Vue server and launch a Hello World Vue webapp that you saw when you performed the pre-requisites.  But let's brand our site and bring in some css that's more in line with what we want our website to look like. 

<li>From a command prompt or terminal shell, navigate to the 'src' subdirectory. Let's first back up some files that we are about to overwrite so that we can understand what's changed:
<br/>
  <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#backup">Copy</button>
<pre><span id="backup">
cp App.vue App.vue.bak
cp components/Hello.vue components/Hello.vue.bak
</span></pre>

<li>Now, run the following commands which will copy some updates to those two files as well as bring in some additional resources.
<br/>

NB: do we need to use wget/curl and the http endpoint instead? To be tested!
<br/>

  <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#awscp">Copy</button>
<pre><span id="awscp">

aws s3 cp s3://iag-serverless-workshop-resources/resources/App.vue App.vue
aws s3 cp s3://iag-serverless-workshop-resources/resources/Hello.vue components/Hello.vue
aws s3 cp --recursive s3://iag-serverless-workshop-resources/resources/assets/* assets

</span></pre>
Optional: Now let's diff the files to see what's changed. (if on Windows try FC instead of diff and DEL instead of rm) 

 <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#diff">Copy</button>
<pre><span id="diff">

diff App.vue App.vue.bak
diff components/Hello.vue components/Hello.vue.bak
rm App.vue.bak 
rm components/Hello.vue.bak

</span></pre>

Now we have a simple static webapp utilizing a progressive framework that will help as we continue to build it out. Let's host our website on s3 now so it becomes a proper website not something running off our local drive.:) 

First we create an S3 bucket called [your unique id]-aws-serverless-workshop. You can do this via the AWS console or with the following CLI commands - but be sure to change [your unique id] with your login id at work (or other unique identifier). If you do it via the console be sure to configure it as a website with the index document as index.html and the error document as error.html.

NB: The command below will work on mac or linux variants but not windows.  In windows take that bit off and make up a random set of numbers such as 83745089375 (but don't use that exactly). This is because S2 bucket names need to be globally unique as they can be served up and need to be propogated to DNS, so this ensures other users with your same id will not conflict in future.

<br/>
 <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#mkbucket">Copy</button>
<pre><span id="mkbucket">

aws s3 mb s3://[your unique id]-aws-serverless-workshop-`date +%s`
aws s3 website s3://[your unique id]-aws-serverless-workshop/ --index-document index.html --error-document error.html

</span></pre>

You may remember that we are running Vue.js in dev mode at this point. We need to convert it to prod mode before we deploy it. Back up out of the src directory into the 'aws-serverless-workshop'. With the next command we use 'npm run build' to build our Vue app in prod mode, and then we push it to our S3 bucket. Be sure to change [your unique id] to your actual unique id.
<br/>
 <button class="btn btn-outline-secondary btn-sm" data-clipboard-target="#prd">Copy</button>
<pre><span id="prd">

npm run build && aws s3 sync dist s3://[your unique id]-aws-serverless-workshop --acl public-read

</span></pre>

</ol>

Now navigate to the console and find your S3 bucket. Select  your bucket and click on properties.  Click Static Website Hosting and copy your URL. You should see a page that looks like this:
<br/>
<br/>
<img src="images/vue-app-screenshot.png"/>


<br/>
<br/>

Cool? Well not really as it's not really doing much. So <a href="serverless-dynamic-website.html"/>&nbsp;&nbsp;&nbsp;&lt;Now let's create the dynamic components&gt;</a>
</body>
</html>
